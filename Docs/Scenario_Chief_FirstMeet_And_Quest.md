# 시나리오 학습: 촌장 첫 만남 → 버섯 5개 퀘스트

코드 작성 전에, **"무엇이 필요하고, 어떤 순서로 일어나는지"** 구조만 정리한 문서입니다.

---

## 1. 우리가 만들 흐름 (한 줄 요약)

- **첫 대화**: 촌장 → "첫 만남" 대사 한 번만
- **그 다음 대화부터**: 촌장 → "버섯 5개 가져와라" 퀘스트 제시 (수락 가능)

저장/로드는 아직 없으니까, **매 플레이 = 항상 이 순서**로 진행된다고 보면 됩니다.

---

## 2. 플레이어가 보는 흐름 (타임라인)

```
[게임 시작]
    ↓
[촌장에게 다가가서 E (상호작용)]
    ↓
[첫 만남 대사 1줄]  ← "안녕, 처음 보는 얼굴이구나. 나는 이 마을 촌장이야."
    ↓ (다음 줄 없으면 대사창 닫힘)
[다시 E로 말 걸기]
    ↓
[퀘스트 대사]  ← "버섯 5개만 구해오면 보답해 주지. 구해올 수 있겠나?"
    ↓ (여기서 퀘스트 "수락" 처리)
[이후로 말 걸면]  ← 퀘스트 진행 중 대사 or 일반 대사
```

즉, **"첫 대화"와 "두 번째 대화(퀘스트)"**를 구분할 **기준**이 하나 필요합니다.

---

## 3. 기준이 되는 것: "상태(플래그)"

- **질문**: "지금 촌장과 처음 만난 건가, 이미 한 번 말한 뒤인가?"
- **답**: 게임이 **기억하는 값 하나**로 구분하면 됩니다.  
  예: `met_촌장 = 0` 이면 "아직 첫 만남 전", `met_촌장 = 1` 이면 "이미 한 번 말함".

이런 값을 보통 **플래그(flag)** 라고 부릅니다.

- **플래그**: "이벤트가 한 번 일어났는지" 같은 **진행 상태**를 숫자(0/1)로 저장해 두는 것.
- **누가 쓸까**:  
  - **쓸 때**: "첫 대사가 끝났다"는 시점에 `met_촌장 = 1` 로 바꿔 둠.  
  - **읽을 때**: 대사를 고를 때 "met_촌장 == 0 이면 첫 만남 대사, 1이면 퀘스트/일반 대사" 로 분기.

그래서 이 시나리오에서는 **최소 하나의 플래그**가 필요하다고 보면 됩니다.

- 예: `met_촌장` (0 = 첫 만남 전, 1 = 첫 만남 완료)

나중에 "버섯 퀘스트 수락함", "버섯 퀘스트 완료함" 같은 것도 **또 다른 플래그**로 두면,  
"수락 전 대사 / 진행 중 대사 / 완료 후 대사"까지 구분할 수 있습니다.

---

## 4. 대화가 "어떤 대사를 골라서 보여줄지" 정하는 흐름

지금 구조에서는 대략 이렇게 되어 있다고 보면 됩니다.

1. 플레이어가 촌장에게 **E (상호작용)**  
   → Npc(촌장)의 **Interact**가 호출됨.
2. Npc는 **"지금 이 NPC에게 뭘 보여줄지"**를 **DialogueManager**에게 물어봄.  
   → `GetBestDialogue("촌장")` 같은 식.
3. **DialogueManager**는  
   - **현재 상태(플래그)** 를 본 다음  
   - "첫 만남인가? / 퀘스트 수락 전인가? / 진행 중인가?" 같은 **우선순위 규칙**으로  
   - **대사 하나(DialogueData)** 를 골라서 반환.
4. 그 대사를 **DialogueSystem**이 화면에 재생.

즉, **"상태(플래그)"** 와 **"대사 데이터(DialogueData)"** 가 연결되어 있어야 하고,  
**"첫 대사가 끝난 뒤"** 에 `met_촌장 = 1` 을 **한 번만** 세팅해 주는 **시점**이 필요합니다.

---

## 5. 필요한 것 정리 (구조만)

### 5.1 상태(플래그)

| 플래그 이름 (예시) | 값 | 의미 |
|-------------------|-----|------|
| `met_촌장` | 0 | 아직 촌장과 말 안 함 |
| `met_촌장` | 1 | 첫 만남 대사 한 번 본 상태 (그 다음부터는 퀘스트/일반 대사) |

(나중에 퀘스트까지 넣으면: `quest_버섯5개_수락`, `quest_버섯5개_완료` 같은 플래그를 더 두면 됨.)

### 5.2 대사 데이터 (DialogueData) 구성 생각

- **첫 만남용 대사 1개**  
  - 조건: `met_촌장 == 0` 일 때만 선택되게.  
  - 내용: "안녕, 처음 보는 얼굴이구나…" 한 줄(또는 여러 줄).
- **퀘스트 제시용 대사 1개**  
  - 조건: `met_촌장 == 1` 이고, 아직 버섯 퀘스트 수락 전.  
  - 내용: "버섯 5개만 구해오면…"

대화 시스템이 **"조건 → 어떤 대사"** 를 지원한다면  
(예: DialogueType.Quest, ConditionKey = "met_촌장", ConditionValue = 1),  
위처럼 **플래그 값**으로 "첫 만남 / 퀘스트 대사"를 나누면 됩니다.

### 5.3 "첫 대사가 끝났을 때" 플래그 세팅

- **언제**: "첫 만남" 대사를 **한 번 다 보여주고 대사창이 닫힐 때**.
- **무엇을**: `met_촌장 = 1` 로 설정.
- **누가**:  
  - 대화 시스템이 "대사 종료" 이벤트를 알려주면,  
  - 그걸 구독한 쪽(예: Npc 전용 로직, 또는 씬 매니저)에서  
  - "방금 재생한 게 '첫 만남' 대사였다"면 플래그만 1로 바꿔 줌.

즉, **"대사 종료" 이벤트**와 **"어떤 대사였는지"**를 연결할 수 있어야 합니다.

### 5.4 퀘스트 (버섯 5개)

- **퀘스트 데이터 1개**  
  - 목표: 버섯 아이템 5개.  
  - 수락: "퀘스트 제시" 대사 후, 한 번 더 말 걸거나 버튼으로 "수락" 하면 QuestManager에 등록.
- **진행**  
  - 인벤토리에 버섯이 들어오면 기존처럼 `OnQuestGoalProcessed` 로 진행도 갱신.  
  - 5개 모이면 "완료" 상태로 두고, 필요하면 `quest_버섯5개_완료 = 1` 같은 플래그도 세팅.

여기서는 **"퀘스트 수락"이 언제 일어나는지**만 정하면 됩니다.  
(예: 퀘스트 대사 재생 후 자동 수락 vs "수락/거절" 버튼.)

---

## 6. 흐름도 (구조만)

```
[플레이어가 촌장에게 E]
         │
         ▼
   GetBestDialogue("촌장")
         │
         ├─ met_촌장 == 0 ?  ──Yes──► [첫 만남 대사] 재생
         │                              │
         │                              ▼ (대사 종료 시)
         │                         met_촌장 = 1 설정
         │
         └─ met_촌장 == 1 ?  ──Yes──► [퀘스트 대사] 재생
                                        │
                                        ▼ (필요하면)
                                   퀘스트 수락 처리
```

- **저장/로드가 없을 때**: 매번 게임 시작 시 `met_촌장 = 0` 인 상태로 시작하면,  
  항상 "첫 대화 → 첫 만남 대사 → (끝나면 met_촌장=1) → 다음엔 퀘스트 대사" 순서가 됩니다.

---

## 7. 나중에 저장/로드를 넣을 때

- **저장**: `met_촌장`, `quest_버섯5개_수락`, `quest_버섯5개_완료` 같은 **플래그들**을 파일/플레이어프리팹에 써 두면 됨.
- **로드**: 게임 시작 시 저장된 플래그만 복원하면,  
  "이미 첫 만남 본 세이브"는 처음부터 met_촌장=1 이라서 퀘스트 대사부터 나오게 할 수 있음.

즉, **지금 설계하는 "플래그 하나로 첫 만남/그 다음 구분"**이 나중에 세이브/로드의 **기본 단위**가 됩니다.

---

## 8. 이 문서만으로 정리되는 것

- **필요한 것**:  
  - 플래그 최소 1개 (met_촌장)  
  - 대사 데이터: "첫 만남" 1개, "퀘스트 제시" 1개  
  - "첫 만남 대사가 끝났을 때" met_촌장 = 1 을 세팅하는 한 군데  
  - (선택) 퀘스트 데이터 1개 + 수락/완료 시 플래그
- **흐름**:  
  E → GetBestDialogue(플래그 참고) → 첫 만남 or 퀘스트 대사 재생 → 필요 시 대사 종료 시 플래그/퀘스트 수락 갱신.

이걸 **공부용 구조**로 두고, 다음 단계에서 "우리 프로젝트의 DialogueManager / QuestManager / FlagManager에는 이걸 어떻게 매핑할지"만 정하면, 그때 코드로 옮기면 됩니다.
